<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper   PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.hospital.mapper.BoardMapper">
    <select id="selectBoardList" parameterType="pagingVo" resultType="map">
        SELECT  *
            ,   date_format(created_date, '%Y-%m-%d') created_show_date
          FROM ${tableName}
         <where>
             <if test="search_text != null and search_text != ''">
                 <if test="type == 'title'">
                     and subject like concat('%', #{search_text}, '%')
                 </if>
                 <if test="type == 'contents'">
                     and contents like concat('%', #{search_text}, '%')
                 </if>
             </if>
             <if test="id != null and id != ''">
                 and id = #{id}
             </if>
         </where>
         ORDER BY created_date desc
         LIMIT #{start}, #{end}
    </select>

    <select id="selectBoardTotal" parameterType="pagingVo" resultType="int">
        SELECT COUNT(*)
          FROM ${tableName}
        <where>
            <if test="search_text != null and search_text != ''">
                <if test="type == 'title'">
                    and subject like concat('%', #{search_text}, '%')
                </if>
                <if test="type == 'contents'">
                    and contents like concat('%', #{search_text}, '%')
                </if>
            </if>
            <if test="id != null and id != ''">
                and id = #{id}
            </if>
        </where>
    </select>

    <select id="selectBoardInfo" parameterType="pagingVo" resultType="map">
        SELECT *
            ,   date_format(created_date, '%Y-%m-%d') created_show_date
          FROM ${tableName}
         WHERE NUM = #{boardNum}
    </select>
    
    <select id="selectPrevNextNum" parameterType="pagingVo" resultType="map">
        SELECT
            (
                SELECT num
                  FROM notice
                 WHERE num IN(
                        SELECT MAX(num)
                        FROM notice
                        WHERE num <![CDATA[ < ]]> #{boardNum}
                )) prevNum,

            (
                SELECT subject
                  FROM notice
                 WHERE num IN(
                        SELECT MAX(num)
                        FROM notice
                        WHERE num <![CDATA[ < ]]> #{boardNum}
                )) prevSubject,

            (
                SELECT num
                  FROM notice
                 WHERE num IN(
                        SELECT min(num)
                        FROM notice
                        WHERE num <![CDATA[ > ]]> #{boardNum}
                )) nextNum,

            (
                SELECT subject
                  FROM notice
                 WHERE num IN(
                        SELECT min(num)
                        FROM notice
                        WHERE num <![CDATA[ > ]]> #{boardNum}
                )) nextSubject
    </select>

    <insert id="insertBoard" parameterType="boardVo" useGeneratedKeys="true" keyProperty="num">
        INSERT INTO ${tableName}
        (
            subject,
            writer,
            contents,
            created_date,
            update_date,
            id
            
            <if test="phone != null and phone != ''">
                ,phone
            </if>

            <if test="email != null and email != ''">
                ,email
            </if>

            <if test="password != null and password != ''">
                ,password
            </if>

            <if test="thumnail != null and thumnail != ''">
                ,thumnail
            </if>

            <if test="thumnail_path != null and thumnail_path != ''">
                ,thumnail_path
            </if>

            <if test="attachfile_code != null and attachfile_code != ''">
                ,attachfile_code
            </if>

            <if test="emailYN != null and emailYN != ''">
                ,emailYN
            </if>

            <if test="smsYN != null and smsYN != ''">
                ,smsYN
            </if>

            <if test="consultType != null and consultType != ''">
                ,consultType
            </if>
        )

        VALUES
        (
            #{subject},
            #{writer},
            #{contents},
            now(),
            now(),
            #{id}

            <if test="phone != null and phone != ''">
                ,#{phone}
            </if>

            <if test="email != null and email != ''">
                ,#{email}
            </if>

            <if test="password != null and password != ''">
                ,#{password}
            </if>

            <if test="thumnail != null and thumnail != ''">
                ,#{thumnail}
            </if>

            <if test="thumnail_path != null and thumnail_path != ''">
                ,#{thumnail_path}
            </if>

            <if test="attachfile_code != null and attachfile_code != ''">
                ,#{attachfile_code}
            </if>

            <if test="emailYN != null and emailYN != ''">
                ,#{emailYN}
            </if>

            <if test="smsYN != null and smsYN != ''">
                ,#{smsYN}
            </if>

            <if test="consultType != null and consultType != ''">
                ,#{consultType}
            </if>
        )
    </insert>

    <insert id="insertFile" parameterType="map">
        INSERT INTO attach
        (
            real_filename,
            download_filename,
            file_path,
            table_name,
            board_num
        )

        VALUES
        (
            #{realFileName},
            #{downloadFilename},
            #{filePath},
            #{tableName},
            #{num}
        )
    </insert>
</mapper>
